/*! inline 0.0.1 2014-12-13 */
/*   */
!function(a){a.chai={},a.chai.ini=function(b){return a.chai.ready(b)}}(jQuery),function(a){a.chai.core={},a.chai.core.util={autosaved:!1,t:null,autoSaver:function(){a.chai.core.util.t=window.setInterval(function(){a.each(a("form.autosave"),function(){var b=a(this);a(".dialog_message.autosave").length<=0&&a("body").append("<div class='dialog_message ui-state-highlight autosave'>"),a(".dialog_message.autosave").html("Auto saving"),a(".dialog_message.autosave").show(),a.ajax({url:a(this).attr("action"),data:"autosave=true&autosaved="+a.chai.core.util.autosaved+"&"+a(this).serialize(),type:"POST",success:function(c){if(c&&"success"===c)a.chai.core.util.autosaved=!0,a(".dialog_message.autosave").html("Auto saved form"),b.trigger("reinitialize.areYouSure");else{if(c&&"unsaved"===c)return window.clearInterval(a.chai.core.util.t),a.chai.core.util.t=null,a(".dialog_message.autosave").html("Will not auto save untill the item is saved."),a(".dialog_message.autosave").show(),void setTimeout(function(){a(".dialog_message.autosave").fadeOut("500")},"4000");a(".dialog_message.autosave").html("Failed to auto save")}a(".dialog_message.autosave").show(),setTimeout(function(){a(".dialog_message.autosave").fadeOut("500")},"1000")}})})},1e4)},start_autoSaver:function(){a("form.autosave").areYouSure({silent:!0,change:function(){a(this).hasClass("dirty")?a.chai.core.util.autoSaver():(window.clearInterval(a.chai.core.util.t),a.chai.core.util.t=null)}})},alais_scruber:function(a,b){var c=a.val();c=c.split(" ").join("-"),c=c.split("&").join("-and-"),c=c.replace(/[^A-Za-z0-9\-_]/g,""),c=c.split("--").join("-"),c=c.split("__").join("_"),c=c.split("/").join(""),b.val(c.toLowerCase())},turnon_alias:function(b,c){b.off().on("keyup",function(){a.chai.core.util.alais_scruber(b,c)})},make_maskes:function(){a.mask.definitions["~"]="[+-]",a('[type="date"],[rel="date"]').mask("99/99/9999",{completed:function(){}}),a("#tab_date").mask("9999",{completed:function(){}}),a("input").blur(function(){}).dblclick(function(){a(this).unmask()}),a("label i[title]").tooltip(),a('[type="date"],[rel="date"]').datepicker()},setup_viewlog:function(){a("#viewlog").on("click",function(b){b.preventDefault(),b.stopPropagation(),a.get("/center/retriveLog.castle",{id:a(this).data("item_id")},function(b){a("#view_log_area").length<=0&&a("body").append('<div id="view_log_area">'),a("#view_log_area").html(b),a("#view_log_area").dialog({autoOpen:!0,resizable:!1,width:.8*a(window).width(),height:.8*a(window).height(),modal:!0,draggable:!1,buttons:{Close:function(){a(this).dialog("close")}},create:function(){a("body").css({overflow:"hidden"})},close:function(){a.chai.core.util.close_dialog_modle(a("#view_log_area"))}})})})},setup_refs:function(){a(".add_ref").on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this).closest(".datagrid").dataTable({aaSorting:[[1,"asc"]]});c.dataTable().fnAddData(["$part.baseid",'<input type="hidden" name="references[$count].baseid" value="$part.baseid" class="drug_item"/>$part.type',"$part.name",'<a href="$item.url" class="ref_link"><i class="icon-external-link"></i></a>',"$item.note",'<a href="substance.castle?id=$part.baseid" class="button small inline_edit" data-type="substance">Edit</a> | <a href="#" class="button xsmall crimson defocus removal">Remove</a>']),a.chai.core.util.setup_ref_copy()})},setup_ref_copy:function(){a.each(a(".ref_text:not(.cp_ready)"),function(){var b=this;a(b).on("click",function(a){a.preventDefault(),a.stopPropagation()});var c=new ZeroClipboard(b);c.on("ready",function(){a(b).addClass("cp_ready"),c.on("aftercopy",function(a){alert("Copied text to clipboard: "+a.data["text/plain"])})})})},setting_item_pub:function(b){b.find(".pubstate").buttonset(),b.find(".pubstate :radio:checked").val()<1?b.find("#noting").next("label").show():b.find("#noting").next("label").hide(),b.find(".pubstate :radio").change(function(){b.find(".pubstate :radio").next("label").find("i").removeClass("icon-check-empty").removeClass("icon-check"),b.find(".pubstate :radio").not(":checked").next("label").find("i").addClass("icon-check-empty"),b.find(".pubstate :radio:checked").next("label").find("i").addClass("icon-check"),b.find(".pubstate :radio:checked").val()<1?b.find("#noting").next("label").show():b.find("#noting").next("label").hide(),b.find("#noting").next("label").find("i").addClass(""!==b.find(".notearea").find("textarea").val()?"icon-file-text-alt":"icon-file-alt")}),b.find("#noting").button(),b.find("#noting").change(function(){b.find(".notearea").dialog({autoOpen:!0,height:300,width:350,modal:!0,buttons:{"CLEAR Note":function(){a(this).find("textarea").val(""),a(this).dialog("close")},Accept:function(){a(this).dialog("close")},Cancel:function(){a(this).dialog("close")}},close:function(){b.find(".noted").find("label").removeClass("ui-state-active");var c=a(this).find("textarea").val();b.find("[name='item.content']").val(c),b.find("#noting").attr("checked",!1),b.find("#noting").next("label").find("i").removeClass("icon-file-text-alt").removeClass("icon-file-alt"),b.find("#noting").next("label").find("i").addClass(""!==c?"icon-file-text-alt":"icon-file-alt"),a(this).dialog("destroy")}})})},popup_message:function(b,c){"undefined"==typeof c&&(c=!1),a("#mess").length<=0&&a("body").append('<div id="mess">'),a("#mess").html("string"==typeof b||b instanceof String?b:b.html()),a("#mess").dialog({autoOpen:!0,resizable:!1,width:350,minHeight:25,modal:!0,draggable:!1,create:function(){c&&(a(".ui-dialog-titlebar").remove(),a(".ui-dialog-buttonpane").remove()),a("body").css({overflow:"hidden"})},buttons:{Ok:function(){a(this).dialog("close")}},close:function(){a("body").css({overflow:"auto"}),a("#mess").dialog("destroy"),a("#mess").remove()}})},add_item_popup:function(b,c,d,e){"undefined"==typeof d&&(d=["new","list"]),0===a("#drug_form").length&&a("#staging").append("<div id='drug_form'><div id='drug_list'></div><div id='drug_item'></div></div>");var f="";a.ajax({cache:!1,url:"/center/"+b+"s.castle",data:{skiplayout:1,exclude:c,typed_ref:a('[name="typed_ref"]').val()},success:function(g){a.inArray("list",d)>-1&&(a("#drug_list").html(g),f+="<a href='#drug_list' id='drug_list_tab' class='popuptab button med active'>List</a>"),a.ajax({cache:!1,url:"/center/"+b+".castle",data:{skiplayout:1,id:"undefined"==typeof e?"":e,typed_ref:a('[name="typed_ref"]').val()},success:function(e){a.inArray("new",d)>-1&&(a("#drug_item").html(e),f+="<a href='#drug_item' id='drug_item_tab' class='popuptab button med'>New</a>"),a("#drug_form").dialog({autoOpen:!0,resizable:!1,width:a(window).width()-50,height:a(window).height()-50,modal:!0,draggable:!1,buttons:{Cancel:function(){a(this).dialog("close")}},create:function(){a("#mess").dialog("destroy"),a("#mess").remove(),""!==a("#drug_item").html()&&""!==a("#drug_list").html()&&(a("#drug_form").closest(".ui-dialog").find(".ui-dialog-title").append(f),a("#drug_item").hide()),a("body").css({overflow:"hidden"}),a(".ui-dialog-buttonpane").remove(),a("#drug_list").html().length>0&&a.chai.core.util.make_popup_datatable(b),a(".popuptab").off().on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(".popuptab.active").attr("href");a(c).hide(),a(".popuptab.active").removeClass("active"),a(this).addClass("active"),c=a(this).attr("href"),a(c).show()}),a.chai.core.util.set_up_form(b,c,d),a.chai.core.util.activate_adverse_ui()},close:function(){a.chai.core.util.close_dialog_modle(a("#drug_form")),a.chai.core.util.last_datatable=null}}),a.chai.core.util.set_diamodle_resizing(a("#drug_form"))}})}})},set_diamodle_resizing:function(b){a(window).resize(function(){b.dialog("option",{width:a(window).width()-50,height:a(window).height()-50})})},close_dialog_modle:function(b){b.dialog("destroy"),b.remove(),a(".ui-dialog.ui-widget.ui-widget-content").length<=0&&a("body").css({overflow:"auto"})},moa_dmpk_setup:function(){a.each(a(".has_moa_dmpk:not(.activated)"),function(){var b=a(this);a(this).addClass("activated");var c=b.closest(".moa_dmpk_block").find(".moa_dmpk");""===b.val()&&c.hide(),b.on("keyup",function(){""===b.val()?(c.find(":selected").attr("selected",!1),c.hide()):c.show()})})},apply_a_taxed_add:function(b,c,d){a("a.tax_add").on("click",function(e){e.preventDefault(),e.stopPropagation(),a.chai.core.util.start_taxed_add(b,c,d)})},start_taxed_add:function(b,c,d){"undefined"===c&&(c=a(a(this).data("select"))),a("#taxonomyitem").length<=0&&a("body").append("<div id='taxonomyitem'>");var e=a("#taxonomyitem");"undefined"===b&&(b=a(this).data("type")),a.ajax({cache:!1,url:"/admin/edit_taxonomy.castle",data:{skiplayout:1,type:b},success:function(b){e.html(b),e.dialog({autoOpen:!0,resizable:!1,modal:!0,draggable:!1,create:function(){a("body").css({overflow:"hidden"}),a("#taxonomyitem .ui-dialog-buttonpane").remove(),e.find('input[name$=".alias"]').closest("p").css({display:"none"})},open:function(){a.chai.core.util.turnon_alias(e.find('input[name$=".name"]'),e.find('input[name$=".alias"]')),"undefined"==typeof d&&a.chai.core.util.make_a_tax_form(c,function(){a.chai.core.util.alais_scruber(e.find('input[name$=".name"]'),e.find('input[name$=".alias"]'))}),"function"==typeof d&&d(c)},close:function(){a.chai.core.util.close_dialog_modle(a("#taxonomyitem"))}}),a(window).resize(function(){var b=.25*a(window).width(),c=.25*a(window).height();a("#taxonomyitem").dialog("option",{width:b,height:c})})}})},make_tax_form:function(b,c,d){var e=a("#taxonomyitem form");e.find('[type="submit"]').on("click",function(f){if(f.preventDefault(),f.stopPropagation(),a("#taxonomyitem form").on("change",function(){var b=!0;a.each(a("input,select"),function(){""!==a(this).not(":hidden").val()&&""!==a(this).not(":hidden").find(":selected").val()&&(b=!1)}),a('#taxonomyitem form input[name="empty"]').val(b+"")}),!e.find('input[name="empty"]').val()){"undefined"!=typeof c&&c();var g=e.find("input, textarea, select").serializeArray();a.ajax({cache:!1,url:"/admin/update_taxonomy.castle?ajax=true",data:g,dataType:"json",success:function(c){""!==c.alias?(b.find(".add").before('<option value="'+c.alias+'" '+(b.is(d)?"selected":"")+" >"+c.name+"</option>"),a("#taxonomyitem").dialog("destroy"),a("#taxonomyitem").remove(),a.chai.core.util.popup_message(a("<span><h5>You have added a  new taxonomy!</h5>It has also selected for you</span>")),a('form[name="entry_form"] :input:first').trigger("change")):a.chai.core.util.popup_message(a("<span>failed to save, try again.</span>"))}})}})},make_a_tax_form:function(b,c){var d=a("#taxonomyitem form");a("#taxonomyitem form").on("change",function(){var b=!0;a.each(a("input,select"),function(){""!==a(this).not(":hidden").val()&&""!==a(this).not(":hidden").find(":selected").val()&&(b=!1)}),a('#taxonomyitem form input[name="empty"]').val(b+"")}),d.find('[type="submit"]').on("click",function(e){if(e.preventDefault(),e.stopPropagation(),!d.find('input[name="empty"]').val()){"function"==typeof c&&c();var f=d.find("input, textarea, select").serializeArray();a.ajax({cache:!1,url:"/center/update_taxonomy.castle?ajax=true",data:f,dataType:"json",success:function(c){""!==c.alias?("function"==typeof b&&b(c),"undefined"!=typeof b&&"function"!=typeof b&&b.find("option:first").before('<option value="'+c.alias+'" >'+c.name+"</option>"),a("#taxonomyitem").dialog("destroy"),a("#taxonomyitem").remove(),a.chai.core.util.popup_message(a("<span><h5>You have added a  new taxonomy!</h5>It has also selected for you</span>")),a('form[name="entry_form"] :input:first').trigger("change")):a.chai.core.util.popup_message(a("<span>failed to save, try again.</span>"))}})}})},apply_tax_request:function(){a.each(a(".requested_taxed:not(.activated)"),function(){var b=a(this);b.addClass("activated"),b.find(".add").length<=0&&b.find("option:last").after('<option value="" class="add">Request new option</option>')}),a(".requested_taxed").on("change",function(){var b=a(this),c=a(this).find("option:selected");if(c.hasClass("add")){c.removeAttr("selected"),a("#taxonomyitem").length<=0&&a("body").append("<div id='taxonomyitem'>");var d='<h3>Make a request for a new item</h3><lable>Name:</lable><input type="text" value=""/><br/><br/><input type="submit" value="Subbmit Request"/>',e=a("#taxonomyitem");e.html(d),e.dialog({autoOpen:!0,resizable:!1,width:450,modal:!0,draggable:!1,create:function(){a("body").css({overflow:"hidden"}),a(".ui-dialog-buttonpane").remove(),e.find('input[name$=".alias"]').closest("p").css({display:"none"}),a.chai.core.util.make_tax_form(b,function(){a.chai.core.util.alais_scruber(e.find('input[name$=".name"]'),e.find('input[name$=".alias"]'))})},open:function(){a.chai.core.util.turnon_alias(e.find('input[name$=".name"]'),e.find('input[name$=".alias"]'))},close:function(){a.chai.core.util.close_dialog_modle(a("#taxonomyitem"))}})}})},apply_taxed_add:function(){a.each(a(".taxed:not(.activated)"),function(){var b=a(this);b.addClass("activated"),b.find(".add").length<=0&&b.find("option:last").after('<option value="" class="add">Add new option</option>')}),a(".taxed").on("change",function(){var b=a(this),c=a(this).find("option:selected");if(c.hasClass("add")){c.removeAttr("selected"),a("#taxonomyitem").length<=0&&a("body").append("<div id='taxonomyitem'>");var d,e=a("#taxonomyitem"),f=b.attr(""!==b.attr("rel")?"rel":"id"),g=b.attr("rel");"undefined"!=typeof g&&g!==!1&&(d=a('[rel="'+f+'"]')),a.ajax({cache:!1,url:"/admin/edit_taxonomy.castle",data:{skiplayout:1,type:f},success:function(c){e.html(c),e.dialog({autoOpen:!0,resizable:!1,modal:!0,draggable:!1,create:function(){a("body").css({overflow:"hidden"}),a(".ui-dialog-buttonpane").remove(),e.find('input[name$=".alias"]').closest("p").css({display:"none"}),a.chai.core.util.make_tax_form(b,function(){a.chai.core.util.alais_scruber(e.find('input[name$=".name"]'),e.find('input[name$=".alias"]'))},d)},open:function(){a.chai.core.util.turnon_alias(e.find('input[name$=".name"]'),e.find('input[name$=".alias"]'))},close:function(){a.chai.core.util.close_dialog_modle(a("#taxonomyitem"))}}),a(window).resize(function(){a("#taxonomyitem").dialog("option",{width:.25*a(window).width(),height:.25*a(window).height()})})}})}})},re_index_meta_items:function(){a.each(a(".adverse_events").closest("ul").find("li[data-taxorder]"),function(b){a(this).data("taxorder",b),a.each(a(this).find("input,select:not([name=''])"),function(){a(this).attr("name",a(this).attr("name").split("[")[0]+"["+b+"]")})})},controll_meta_items:function(){a(".remove").hover(function(){a(this).removeClass("red")},function(){a(this).addClass("red")}),a(".remove").on("click",function(){var b=a(this).closest("li"),c=b.find('[name^="option"]').val();a(".adverse_events option[value='"+c+"']").removeAttr("disabled"),b.fadeOut(function(){a(this).remove()})}),a.chai.core.util.re_index_meta_items()},activate_adverse_ui:function(){a(".adverse_events").on("change",function(){var b=a(this).val(),c=a(this).find('option[value="'+b+'"]');if(!c.is(".add")){var d=a(this).closest("ul"),e=c.data("baseid"),f=c.data("content"),g=c.data("alias"),h="none"===g?"":"required";d.append('<li data-taxorder="9999" data-name="'+c.val()+'"><i class="icon-remove-circle red right remove"></i><label>'+c.text()+' <i class="icon-question-sign blue" title="'+f+'"></i></label><input type="'+("none"===g?"hidden":"text")+'" name="value[9999]" id="" '+h+' value=""/><input type="hidden" name="option_key[9999]" value="'+e+'" /></li>'),c.attr("disabled",!0),a(this).val(""),a.chai.core.util.controll_meta_items(),a.chai.core.util.re_index_meta_items(),a.chai.core.util.make_maskes()}}),a.chai.core.util.controll_meta_items()},get_table_ids:function(b){var c="",d=b.dataTable().fnGetNodes();return a.each(d,function(b,d){var e=a(d).find("input.list_item");c+=(""===c?"":",")+e.val()}),c},get_select_ids:function(b){var c="";return a.each(b.find("option"),function(){c+=(""===c?"":",")+a(this).val()}),c},set_up_form:function(b){a.chai.core.util.make_maskes(),a.chai.core.util.moa_dmpk_setup(),a.chai.core.util.apply_tax_request(),a.chai.core.util.apply_taxed_add(),a.chai.core.util.setting_item_pub(a(".ui-dialog")),a('input[name^="post"]').val(a('input[name="item.baseid"]').val()),a("#load_file").on("click",function(){a(".load_file").toggleClass("active")}),a("#drug_form [type='submit']").on("click",function(c){var d=a(this).closest("form");d.find(":invalid").length<=0&&(c.preventDefault(),c.stopPropagation(),a.post(d.attr("action")+"?skiplayout=1&ajaxed_update=1",d.serialize(),function(){a("#drug_form").dialog("destroy"),a("#drug_form").remove(),a(".add_to_list[data-type='"+b+"']").trigger("click")}))})},make_datatable_popup_add:function(b,c){a(".additem").off().on("click",function(d){d.preventDefault(),d.stopPropagation();var e=a(this),f=e.closest("tr"),g=f.data("baseid"),h=b.find("tbody").find("tr").length;"reference"===c&&(h+=1);var i=f.find("td").length,j=[],k=("reference"===c?"":"item.")+c+"s["+(h-1)+"].baseid",l=f.find("td:first").text()+'<input type="hidden" name="'+k+'" value="'+g+'" class="drug_item list_item"/>';j.push(l),j.push(f.find("td:first").next("td").text()),i>3&&j.push(f.find("td:first").next("td").next("td").text()),i>4&&j.push(f.find("td:first").next("td").next("td").next("td").text());var m;if("reference"===c){var n=f.find("td:first").text();m='<button class="ref_text" data-clipboard-text="#{{REF '+n+'}}" title="Click to copy me.">Copy Ref</button>'}j.push('<a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'+m),a("[data-active_grid='true']").dataTable().fnAddData(j),f.fadeOut("75",function(){b.fnDeleteRow(b.fnGetPosition(f.get(0)))}),a("#drug_form").append("<span class='dialog_message ui-state-highlight'>Added to this "+a("#header_title").text()+"</span>"),setTimeout(function(){a(".dialog_message").fadeOut("500")},"1000"),"reference"===c&&a.chai.core.util.setup_ref_copy(),a("ul .display.datagrid.dataTable .removal").off().on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this).closest("tr"),d=a(this).closest(".datagrid").dataTable();c.fadeOut("75",function(){d.fnDeleteRow(d.fnGetPosition(c.get(0)))})})})},last_datatable:null,make_popup_datatable:function(b){a.each(a(".datagrid:not(.dataTable)"),function(){var c=a(this);c.dataTable({bJQueryUI:!0,sPaginationType:"full_numbers",fnDrawCallback:function(){a.chai.core.util.make_datatable_popup_add(c,b)}}),a.chai.core.util.last_datatable=c,a.chai.core.util.make_datatable_popup_add(c,b)})},make_dataTables:function(){if(a(".datagrid:not(.dataTable)").length){var b=a(".datagrid:not(.dataTable)");a.each(b,function(){var b=a(this);b.dataTable({bJQueryUI:!0,sPaginationType:"full_numbers",aaSorting:[[1,"asc"]]})});var c=a(".add_to_list");a.each(c,function(){var b=a(this);b.on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this),d=c.data("type"),e=c.prev(".dataTables_wrapper").find(".datagrid");a("[data-active_grid='true']").attr("data-active_grid",!1),e.attr("data-active_grid",!0);var f="";e.find(".dataTables_empty").length<=0&&(f=a.chai.core.util.get_table_ids(e)),a.chai.core.util.popup_message('<span style="font-size: 28px;"><i class="icon-spinner icon-spin icon-large"></i> loading ... </span>',!0),a.chai.core.util.add_item_popup(d,f,["new","list"])})})}var d=a(".display.datagrid.dataTable .removal");a.each(d,function(){var b=a(this);b.on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this),d=c.closest("tr"),e=c.closest(".datagrid").dataTable();d.fadeOut("75",function(){var a=d.get(0);e.fnDeleteRow(e.fnGetPosition(a))})})})}}}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{a=decodeURIComponent(a.replace(g," "))}catch(b){return}try{return h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setDate(k.getDate()+j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}),function(a){a.fn.areYouSure=function(b){var c=a.extend({message:"You have unsaved changes!",dirtyClass:"dirty",change:null,silent:!1,addRemoveFieldsMarksDirty:!1,fieldEvents:"change keyup propertychange input",fieldSelector:":input:not(input[type=submit]):not(input[type=button])"},b),d=function(b){if(b.hasClass("ays-ignore")||b.hasClass("aysIgnore")||b.attr("data-ays-ignore")||void 0===b.attr("name"))return null;if(b.is(":disabled"))return"ays-disabled";var c,d=b.attr("type");switch(b.is("select")&&(d="select"),d){case"checkbox":case"radio":c=b.is(":checked");break;case"select":c="",b.find("option").each(function(){var b=a(this);b.is(":selected")&&(c+=b.val())});break;default:c=b.val()}return c},e=function(a){a.data("ays-orig",d(a))},f=function(b){var e=function(a){var b=a.data("ays-orig");return void 0===b?!1:d(a)!==b},f=a(this).is("form")?a(this):a(this).parents("form");if(e(a(b.target)))return void h(f,!0);var g=f.find(c.fieldSelector);if(c.addRemoveFieldsMarksDirty){var i=f.data("ays-orig-field-count");if(i!==g.length)return void h(f,!0)}var j=!1;g.each(function(){var b=a(this);return e(b)?(j=!0,!1):void 0}),h(f,j)},g=function(b){var d=b.find(c.fieldSelector);a(d).each(function(){e(a(this))}),a(d).unbind(c.fieldEvents,f),a(d).bind(c.fieldEvents,f),b.data("ays-orig-field-count",a(d).length),h(b,!1)},h=function(a,b){var d=b!==a.hasClass(c.dirtyClass);a.toggleClass(c.dirtyClass,b),d&&(c.change&&c.change.call(a,a),b&&a.trigger("dirty.areYouSure",[a]),b||a.trigger("clean.areYouSure",[a]),a.trigger("change.areYouSure",[a]))},i=function(){var b=a(this),d=b.find(c.fieldSelector);a(d).each(function(){var b=a(this);b.data("ays-orig")||(e(b),b.bind(c.fieldEvents,f))}),b.trigger("checkform.areYouSure")},j=function(){g(a(this))};return c.silent||window.aysUnloadSet||(window.aysUnloadSet=!0,a(window).bind("beforeunload",function(){var b=a("form").filter("."+c.dirtyClass);if(0!==b.length){if(window.navigator.userAgent.toLowerCase().match(/msie|chrome/)){if(window.aysHasPrompted)return;window.aysHasPrompted=!0,window.setTimeout(function(){window.aysHasPrompted=!1},900)}return c.message}})),this.each(function(){if(a(this).is("form")){var b=a(this);b.submit(function(){b.removeClass(c.dirtyClass)}),b.bind("reset",function(){h(b,!1)}),b.bind("rescan.areYouSure",i),b.bind("reinitialize.areYouSure",j),b.bind("checkform.areYouSure",f),g(b)}})}}(jQuery),$.fn.hideOptionGroup=function(){$.each($(this),function(){var a=$(this),b=a.attr("label"),c=a.closest("select").attr("name"),d=$("select").index(a.closest("select"));a.attr("data-pname",c),$("."+b+"_contaner_"+d).length<=0&&$("body").append("<select style='position:absolute;top:-9999em;left:-9999em;' class='"+b+"_contaner_"+d+"'><select>");var e=$("."+b+"_contaner_"+d);a.children().each(function(){$(this).removeAttr("selected")}),a.appendTo(e)})},$.fn.showOptionGroup=function(){$.each($(this),function(){var a=$(this).data("pname");$(this).appendTo($("select[name='"+a+"']"))})},function(a){a(document).ready(function(){a("#viewonly").change(function(){var b=a("#viewonly:checked").length;a.cookie("hivviewonly",1===b?"true":"false",{expires:1,path:"/"}),window.location=window.location.href}),a(".pubstate").buttonset(),a(".pubstate.menuaction :radio").on("change",function(){a(".pubstate :radio").next("label").find("i").removeClass("icon-check-empty").removeClass("icon-check"),a(".pubstate :radio").not(":checked").next("label").find("i").addClass("icon-check-empty"),a(".pubstate :radio:checked").next("label").find("i").addClass("icon-check");var b=a(".pubstate :radio:checked").val();a.cookie("hivpubview",1===b?"true":"false",{expires:1,path:"/"}),window.location=window.location.href.split("?")[0]+"?pub="+b}),a.chai.core.util.setting_item_pub(a(".container")),a(".message.ui-state-highlight").length&&setTimeout(function(){a(".message.ui-state-highlight").fadeOut(500)},2e3)})}(jQuery),$.chai.form_base={ini:function(){$.chai.core.util.start_autoSaver(),$.chai.core.util.moa_dmpk_setup(),$.chai.core.util.make_maskes(),$.chai.core.util.setup_refs(),$.chai.core.util.apply_tax_request(),$.chai.core.util.apply_taxed_add(),$.chai.core.util.apply_a_taxed_add(),$.chai.core.util.activate_adverse_ui(),$.chai.core.util.make_dataTables(),$("option.add_item").on("click",function(a){a.preventDefault(),a.stopPropagation(),$(this).attr("selected",!1),$.chai.core.util.add_item_popup($(this).closest("select").data("type"),$.chai.core.util.get_select_ids($(this).closest("select")),["new"])}),$(".inline_edit").on("click",function(a){a.preventDefault(),a.stopPropagation(),$.chai.core.util.popup_message('<span style="font-size: 28px;"><i class="icon-spinner icon-spin icon-large"></i> </span>',!0),$.chai.core.util.add_item_popup($(this).data("type"),"",["new"],$(this).closest("tr").data("baseid"))})}},$.chai.family={ini:function(){$.chai.core.util.setup_viewlog(),$.chai.form_base.ini(),$("#substances_disabled").on("click",function(a){a.preventDefault(),a.stopPropagation(),$("#substances_disabled_mess").length<=0&&$("body").append('<div id="substances_disabled_mess">'),$("#substances_disabled_mess").html($(this).attr("title")),$("#substances_disabled_mess").dialog({autoOpen:!0,resizable:!1,width:350,minHeight:25,modal:!0,draggable:!1,create:function(){$(".ui-dialog-titlebar").remove(),$("body").css({overflow:"hidden"})},open:function(){},buttons:{Ok:function(){$(this).dialog("close"),window.location="/center/substance.castle"}},close:function(){$.chai.core.util.close_dialog_modle($("#substances_disabled_mess"))}})}),$("#sortable").sortable({handle:".sortable_handle",placeholder:"ui-state-highlight",stop:function(){$.chai.family.sortedCode()}}),$("#famSubAdd").on("click",function(a){a.preventDefault(),a.stopPropagation(),$.getJSON("/center/substances.castle?json=true&callback=?",function(a){var b="";$.each(a,function(a,c){$('[name="substances['+c.baseid+'].baseid"]').length<=0&&(b+="<span class='item i"+a+"' data-baseid='"+c.baseid+"' data-name='"+c.name+"' data-abbreviated='"+c.abbreviated+"'  ><i title='edit' class='icon-plus'></i>"+c.name+" ( "+c.abbreviated+" )<br/></span>")}),""===b&&(b="There are no substances to use."),$("#substances_list").length<=0&&$("body").append('<div id="substances_list">'),$("#substances_list").html(b),$("#substances_list").dialog({autoOpen:!0,resizable:!1,width:350,minHeight:25,modal:!0,draggable:!1,create:function(){$(".ui-dialog-titlebar").remove(),$("body").css({overflow:"hidden"})},open:function(){$(".item .icon-plus").on("click",function(){var a=$(this).closest("span");a.fadeOut("fast");var b="<li class='substance_item'>";b+="<i title='edit' class='icon-trash'></i>",b+="<span class='sortable_handle'>handle</span> "+a.data("name")+" (<span class='sub_code'>"+a.data("abbreviated")+"</span>)",b+="<input type='hidden' name='substances["+a.data("baseid")+"].baseid' value='"+a.data("baseid")+"' class='substance'/>",b+="<input type='hidden' name='family_substance["+a.data("baseid")+"].baseid' value='0'  class=''/>",b+="<input type='hidden' name='family_substance["+a.data("baseid")+"].family.baseid' value='"+$('[name="item.baseid"]').val()+"'  class=''/>",b+="<input type='hidden' name='family_substance["+a.data("baseid")+"].substance_order' value='"+$(".substance_item").length+"'  class='substanceOrder'/>",b+="<input type='hidden' name='family_substance["+a.data("baseid")+"].substance.baseid' value='"+a.data("baseid")+"'  class=''/>",b+="</li>",$(b).appendTo("#sortable"),$("#sortable").sortable("refresh"),$.chai.family.sortedCode()})},buttons:{Ok:function(){$(this).dialog("close")}},close:function(){$.chai.core.util.close_dialog_modle($("#substances_list"))}})})}),$("#famSubCode .icon-edit").on("click",function(){$("#subCodeEdit").is($(".open"))?$("#subCodeEdit").slideUp("slow",function(){$("#subCodeEdit").removeClass("open"),$("#subCodeEdit").addClass("closed")}):$("#subCodeEdit").slideDown("slow",function(){$("#subCodeEdit").addClass("open"),$("#subCodeEdit").removeClass("closed")})}),$("#subCodeEdit .icon-power-off").on("click",function(){$("#subCodeEdit").slideUp("slow",function(){$("#subCodeEdit").removeClass("open"),$("#subCodeEdit").addClass("closed")})}),$.chai.family.sortedCode(),$.chai.drug.setup_ddi_ui(),$.each($('.drpro_table:not(".dataTable")'),function(){var a=$(this);a.DataTable({bJQueryUI:!0,sPaginationType:"full_numbers",fnDrawCallback:function(){$("#drpro_table").find(".drpro_table .dataTables_empty").html('No drug products available. <a href="#" class="add_drPro">Add <i title="edit" class="icon-plus"></i></a>'),$("#drpro_table").find(".add_drPro").off().on("click",function(a){a.preventDefault(),a.stopPropagation(),$.chai.family.add_drProTableRow()}),$("#drpro_table").find(".removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".dataTable").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})})}})})},sortedCode:function(){$(".substance_item .icon-trash").off().on("click",function(){$(this).closest(".substance_item").fadeOut("fast",function(){$(this).remove(),$.chai.family.sortedCode()})});var a="";$.each($(".substance_item"),function(b){a+=(""===a?"":"<em>:</em>")+$(this).find(".sub_code").text(),$(this).find(".substanceOrder").val(b+1)}),$("#sub_code").html(a)},add_drProTableRow:function(){var a="";a+="<div id='drPro_additions' class='min'>",a+="<h4>Create new Drug</h4>",a+="<div id='create_drPros_stub' class='full-input'>",a+="<form action='/center/savedrug.castle' method='post'><input name='item.baseid' type='hidden' value='0'>",a+="<input type='hidden' name='item.families.substance_id' value='"+$("[name='item.baseid']").val()+"'/>";var b=$("#drug_forms").html();a+="Form: "+b+"<!--<input type='text' name='item.dose_form' value='' style='display: inline-block; max-width:50%;'/>-->",a+="<input type='hidden' name='item.attached' value='false'/>",a+="<label>Unit <select name='item.dose_unit' style='display: inline-block; max-width:50%;'><option value=''>Select Unit</option><option value='mg'>mg</option><option value='mg/ml'>mg/ml</option></select></label>",a+="<label>Amounts<br/>",$.each($(".substance_item"),function(){a+="<span style='min-width:20%'>"+$(this).find(".sub_code").text()+":</span> <input type='text' class='sub_label_claim' style='width: auto; display: inline-block; max-width: 100%;' /><br/>"}),a+="</label>",a+="<input type='hidden' name='label_claim'/><br/>",a+="<label>Manufacturer<br/><select name='item.manufacturer' id='quick_drPro_manufacturer'><option value=''>Select</option></select><br/></label>",a+="</form>",a+="</div>",a+="</div>",a+="<div class='clearfix'></div>",$("#form_list").length<=0&&$("body").append('<div id="form_list">'),$("#form_list").html(a),$("#form_list").dialog({autoOpen:!0,resizable:!1,width:350,minHeight:150,height:"auto",maxHeight:$(window).height(),modal:!0,draggable:!1,create:function(){$(".ui-dialog-titlebar").remove(),$("body").css({overflow:"hidden"}),$(".ui-dialog-buttonset").prepend("<a href='#' id='create_drPros_stub_submit' class='button'>Add drug product stub</a>")},open:function(){$.getJSON("/center/get_taxonomies.castle?tax=commercial&callback=?",function(a){var b="";$.each(a,function(a,c){b+="<option value='"+c.alias+"'>"+c.name+"</option>"}),$("#quick_drPro_manufacturer").append(b)
}),$("#create_drPros_stub_submit").on("click",function(a){a.preventDefault(),a.stopPropagation();var b="";$.each($(".sub_label_claim"),function(a){a>0&&(b+=":"),b+=$.trim($(this).val())}),$('[name="label_claim"]').val(b),$('[name="label_claim"]').val(b);var c=$("#create_drPros_stub form").find("input, textarea, select").serializeArray();$.ajax({cache:!1,url:$("#create_drPros_stub form").attr("action")+"?json=true&ajaxed_update=true&callback=?",data:c,dataType:"json",success:function(a){""!==a.baseid?($.chai.core.util.popup_message($("<span><h5>You have added a new Durg Protuct!</h5> It was added to the table of products for the drug form.</span>")),$("#drpro_empty").remove(),$('[href="#existing_drPros"]').trigger("click"),$.each(a,function(a,b){var c=$("#drpro_table").find(".dataTable"),d=[],e=$(".drug_item.list_item").length;d.push(b.form),$.each(b.label_claim.split(":"),function(a,b){d.push(b)}),d.push(b.manufacturer),d.push('<input type="hidden" name="drugs['+e+'].baseid" value="'+b.baseid+'" class="drug_item list_item"/><a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'),c.dataTable().fnAddData(d),$("ul .display.datagrid.dataTable .removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".dataTable").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})})}),$.chai.core.util.autoSaver(),$("#form_list").dialog("close")):$.chai.core.util.popup_message($("<span>failed to save, try again.</span>"))}})})},buttons:{Close:function(){$(this).dialog("close")}},close:function(){$.chai.core.util.close_dialog_modle($("#form_list"))}})}},$.chai.markets={ui:{tabs:null,tabTitle:null,tabTemplate:null,tabCounter:null},ini:function(){$.chai.markets.ui.tabs=$("#tabed").tabs().addClass("ui-tabs-vertical ui-helper-clearfix"),$(".ui-state-default span.ui-icon-close").on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("li").remove().attr("aria-controls");$("#"+b).remove(),$.chai.markets.ui.tabs.tabs("refresh"),$.each($('input[name^="markets_counts["]'),function(a){$(this).attr("name","markets_counts["+(a+1)+"]")})}),$("#tabed li").removeClass("ui-corner-top").addClass("ui-corner-left"),$("#newyear").on("click",function(a){a.preventDefault(),a.stopPropagation(),$("#marketdialog").length<=0&&$("body").append('<div id="marketdialog" title="Tab data"><form><fieldset class="ui-helper-reset"><label for="tab_title">Year</label><input type="number" name="tab_date" id="tab_date" value="" class="ui-widget-content ui-corner-all" /></fieldset></form></div>'),$.chai.markets.ui.tabTitle=$("#tab_date"),$.chai.markets.ui.tabTemplate="<li><a href='#{href}'>#{label}</a> <span class='ui-icon ui-icon-close' role='presentation'>Remove Tab</span></li>",$.chai.markets.ui.tabCounter=$("#tabed li").length;var b=new Date,c=$("#marketdialog").dialog({autoOpen:!0,modal:!0,create:function(){$.chai.core.util.make_maskes(),$("#tab_date").spinner({min:1980,max:b.getFullYear()+2,create:function(){$("#tab_date").spinner("value",b.getFullYear())},change:function(){$("#tab_date").val()>b.getFullYear()+2&&($("#marketdialog").append('<p style="display:block; background-color:yellow; color:red; padding: 2px 5px;" id="yearWarning">You reached the max year. Reseting the year for you.</p>'),setTimeout(function(){$("#yearWarning").fadeOut(500)},2e3),$("#tab_date").val(b.getFullYear()+2))}})},buttons:{Add:function(){$.chai.markets.addTab(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){d[0].reset()}}),d=c.find("form").submit(function(a){$.chai.markets.addTab(),c.dialog("close"),a.preventDefault()});$.chai.markets.ui.tabs.delegate("span.ui-icon-close","click",function(){var a=$(this).closest("li").remove().attr("aria-controls");$("#"+a).remove(),$.chai.markets.ui.tabs.tabs("refresh"),$.each($('input[name^="markets_counts["]'),function(a){$(this).attr("name","markets_counts["+(a+1)+"]")})}),$.chai.markets.ui.tabs.bind("keyup",function(a){if(a.altKey&&a.keyCode===$.ui.keyCode.BACKSPACE){var b=$.chai.markets.ui.tabs.find(".ui-tabs-active").remove().attr("aria-controls");$("#"+b).remove(),$.chai.markets.ui.tabs.tabs("refresh")}})})},addTab:function(){var a=$.chai.markets.ui.tabTitle.val()||"Tab "+$.chai.markets.ui.tabCounter,b="tabs-"+$.chai.markets.ui.tabCounter,c=$($.chai.markets.ui.tabTemplate.replace(/#\{href\}/g,"#"+b).replace(/#\{label\}/g,a));$.chai.markets.ui.tabs.find(".ui-tabs-nav").prepend(c);var d=$("#querybed").html(),e=d.replace(/\{\{YEAR\}\}/g,a);e=e.replace(/\{\{COUNT\}\}/g,$.chai.markets.ui.tabCounter+1).replace(/\{\{__\}\}/g,""),$.chai.markets.ui.tabs.append("<div id='"+b+"'>"+e+"</div>"),$.chai.markets.ui.tabs.tabs("refresh"),$.chai.markets.ui.tabs.tabs("option","active",$.chai.markets.ui.tabCounter),$.chai.markets.ui.tabCounter++,$.each($('input[name^="markets_counts["]'),function(a){$(this).attr("name","markets_counts["+(a+1)+"]")})}},$.chai.reports={ini:function(){$.chai.form_base.ini(),$('select[name^="property"],.property_selector').length&&$("#types").on("change",function(){$.chai.reports.set_prop_sel($("#types").val()),$(".input_box").removeClass("showen"),$(".input_box.gen").addClass("showen"),$(".input_box [name*=value]").val("")}).trigger("change"),$("#ADD_query").on("click",function(a){a.preventDefault(),a.stopPropagation(),$(".query_item:not('#queryBed .query_item')").last().after($("#queryBed").html()),$(".REMOVE_query").off().on("click",function(a){a.preventDefault(),a.stopPropagation(),$(this).closest(".query_item").fadeOut("150",function(){$(this).remove(),$.chai.reports.make_prop_select(),$.chai.reports.re_index_query_items()})}),$.chai.reports.make_prop_select(),$.chai.reports.re_index_query_items(),$.chai.reports.set_prop_sel($("#types").val())}),$.chai.reports.make_prop_select(),$("#start_save_query").on("click",function(a){a.preventDefault(),a.stopPropagation(),$("#to_save_query").slideDown(),$("#start_save_query").slideUp()})},re_index_query_items:function(){$.each($(".query_item:not('#queryBed .query_item')"),function(a){$.each($(this).find("input:visible ,select:visible "),function(){$(this).attr("name",$(this).attr("name").split("[")[0]+"["+a+"]")})})},make_prop_select:function(){$(".property_selector").off().on("change",function(){var a=$(this).val(),b=$(this).closest(".query_item");b.find(".input_box input,.input_box select").removeAttr("name"),b.find(".input_box [name*=value]").val(""),b.find(".input_box").removeClass("showen"),b.find(".input_box."+a).addClass("showen"),b.find(".input_box:visible").length<=0&&b.find(".input_box.gen").addClass("showen"),b.find(".input_box:visible input,.input_box:visible select").attr("name","value[9999]"),$.chai.reports.re_index_query_items()})},set_prop_sel:function(a){$.each($('form select.property_selector,form select[name="selected_properties"]'),function(){$(this).find("option").attr("selected",!1),$(this).find("optgroup").hideOptionGroup();var b=$(this).closest("select").attr("name");$("optgroup."+a+'s[data-pname="'+b+'"]').showOptionGroup()})}},$.chai.trial={ini:function(){$.chai.core.util.setup_viewlog(),$.chai.form_base.ini(),$.chai.trial.trial_arm_primer(),$(".trial_inline_edit").on("click",function(a){a.preventDefault(),a.stopPropagation(),$.chai.core.util.popup_message('<span style="font-size: 28px;"><i class="icon-spinner icon-spin icon-large"></i> Loading content...</span>',!0),$.chai.trial.trial_arm_form($(this).closest("tr").data("baseid"))})},trial_arm_primer:function(){$(".trial_arm_form").on("click",function(a){a.preventDefault(),a.stopPropagation(),$.chai.core.util.popup_message('<span style="font-size: 28px;"><i class="icon-spinner icon-spin icon-large"></i> Loading content...</span>',!0),$.chai.trial.trial_arm_form()})},trial_arm_form:function(a){0===$("#trial_arm_form").length&&$("#staging").append("<div id='trial_arm_form'></div>"),$.ajax({cache:!1,url:"/center/clinical.castle",data:{skiplayout:1,id:"undefined"==typeof a?"":a,typed_ref:$('[name="typed_ref"]').val()},success:function(a){var b=$("#trial_arm_form");b.html(a),b.dialog({autoOpen:!0,resizable:!1,width:$(window).width()-50,height:$(window).height()-50,modal:!0,draggable:!1,buttons:{Cancel:function(){$(this).dialog("close")}},create:function(){$("#mess").dialog("destroy"),$("#mess").remove(),$("body").css({overflow:"hidden"}),$(".ui-dialog-buttonpane").remove(),$.chai.clinical.ini();var a=b.find(".tab_content").hide(),c=b.find("ul.tabs li");c.addClass("tabed"),c.first().addClass("active").show(),a.first().show(),c.on("click",function(b){b.preventDefault(),b.stopPropagation();var c=$(this),d=c.find("a").attr("href");return c.hasClass("active")||(c.addClass("active").siblings().removeClass("active"),a.hide().filter(d).fadeIn()),!1}),$(".uitabs").tabs(),b.find('[name="item.trials.baseid"]').val($('.container [name="item.baseid"]').val()),b.find("[type='submit']").on("click",function(a){var b=$(this).closest("form");b.find(":invalid").length<=0&&(a.preventDefault(),a.stopPropagation(),$.chai.core.util.popup_message('<span style="font-size: 28px;"><i class="icon-spinner icon-spin icon-large"></i>Saving...</span>',!0),$.post(b.attr("action")+"?skiplayout=1&ajaxed_update=1",b.serialize(),function(){$("#mess").dialog("destroy"),$("#mess").remove();var a=$("#trial_arms.tab_content").find(".dataTable"),c=[],d=b.find('[name="item.name"]').val();c.push(d),c.push(b.find('[name="item.name"]').val()),c.push(b.find('[name="item.name"]').val()),c.push('<a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'),a.dataTable().fnAddData(c),$("ul .display.datagrid.dataTable .removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".dataTable").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})}),$("#trial_arm_form").dialog("destroy"),$("#trial_arm_form").remove()}))})},close:function(){$.chai.core.util.close_dialog_modle($("#trial_arm_form"))}}),$.chai.core.util.set_diamodle_resizing($("#trial_arm_form"))}})}},$.chai.trial_arm={ini:function(){$.chai.core.util.setup_viewlog(),$.chai.form_base.ini()}},$.chai.clinical={resetFeildset:function(a){a.find(":radio").next("label").find("i").removeClass("icon-check-empty").removeClass("icon-check"),a.find(":radio").not(":checked").next("label").find("i").addClass("icon-check-empty"),a.find(":radio:checked").next("label").find("i").addClass("icon-check");var b=a.closest("fieldset").find("ul");b.is(".open")?b.hide("fast",function(){b.removeClass("open")}):b.show("fast",function(){if(b.addClass("open"),$("#fed_block").find("ul").is(".open")&&$("#fasting_block").find("ul").is(".open")){var a;a=$(b.closest("fieldset").is("#fed_block")?"#fasting_block":"#fed_block"),a.find("ul").hide("fast",function(){a.find("ul").removeClass("open"),a.find('.showFeildset :radio[value="yes"]').removeAttr("checked"),a.find('.showFeildset :radio[value="yes"]').next("label").removeClass("ui-state-active"),a.find('.showFeildset :radio[value="yes"]').next("label").find("i").addClass("icon-check-empty").removeClass("icon-check"),a.find('.showFeildset :radio[value="no"]').next("label").find("i").addClass("icon-check").removeClass("icon-check-empty"),a.find('.showFeildset :radio[value="no"]').next("label").addClass("ui-state-active"),a.find('.showFeildset :radio[value="no"]').attr("checked","checked")})}})},set_drugTable_removal:function(){$("#Drugdata .removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".datagrid").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})})},ini_list_to_datatable:function(){$(".additem").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$("#drug_list #data").dataTable(),c=$(this),d=c.closest("tr"),e=d.data("baseid"),f=$("#drug_products .datagrid tbody tr").length+1;$("#drug_products .datagrid tbody tr td.dataTables_empty").length&&f--,console.log("in list before add "+f);var g=d.find("td").length,h=[],i=d.find("td:first").text()+'<input type="hidden" name="drugs['+f+'].baseid" value="'+e+'" class="drug_item list_item"/>';h.push(i);for(var j=1;g-1>j;j++)console.log("td "+j),h.push(d.find("td:eq("+j+")").text());h.push('<a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'),$("#drug_products").find(".datagrid").dataTable().fnAddData(h),d.fadeOut("75",function(){b.fnDeleteRow(b.fnGetPosition(d.get(0)))}),$("#drug_form").append("<span class='dialog_message ui-state-highlight'>Added to this "+$("#header_title").text()+"</span>"),setTimeout(function(){$(".dialog_message").fadeOut("500")},"1000"),$.chai.clinical.set_drugTable_removal(),$.chai.clinical.ini_list_to_datatable(),$.chai.core.util.autoSaver(),console.log("in list after add "+$("#drug_products .datagrid tbody tr").length)})},get_current_drugList:function(){var a="";return $.each($("#drug_products tbody tr"),function(){a+=(""===a?"":",")+$(this).data("baseid")}),a},ini:function(){$.chai.core.util.setup_viewlog(),$.chai.form_base.ini(),$.chai.drug.setup_ddi_ui(),$.each($(".showFeildset"),function(){var a=$(this);a.buttonset(),a.find(":radio").on("change",function(){$.chai.clinical.resetFeildset(a)})}),$(".drug_pro_add_item").on("click",function(a){a.preventDefault(),a.stopPropagation(),0===$("#drug_form").length&&$("#staging").append("<div id='drug_form'><div id='drug_list'></div></div>"),$.ajax({cache:!1,url:"/center/drugs.castle",data:{skiplayout:1,exclude:$.chai.clinical.get_current_drugList(),typed_ref:$('[name="typed_ref"]').val()},success:function(a){$("#drug_list").html(a),$("#drug_form").dialog({autoOpen:!0,resizable:!1,width:$(window).width()-50,height:$(window).height()-50,modal:!0,draggable:!1,buttons:{Cancel:function(){$(this).dialog("close")}},create:function(){$("#mess").dialog("destroy"),$("#mess").remove(),$("body").css({overflow:"hidden"}),$(".ui-dialog-buttonpane").remove()},open:function(){var a=$("#drug_list #data").DataTable({bJQueryUI:!0,sPaginationType:"full_numbers",fnDrawCallback:function(){}});$.each($("#drug_list #data thead th"),function(b){var c=$('<select><option value=""></option></select>').appendTo($(this)).on("change",function(){var c=$(this).val();a.column(b).search(c,!1,!0,!0).draw()});a.column(b).data().unique().sort().each(function(a){c.append('<option value="'+a+'">'+a+"</option>")})}),$.chai.clinical.ini_list_to_datatable()},close:function(){$.chai.core.util.close_dialog_modle($("#drug_form"))}}),$.chai.core.util.set_diamodle_resizing($("#drug_form"))}})})}},$.chai.drug={ini:function(){$.chai.core.util.setup_viewlog(),$.chai.form_base.ini(),$("select[name*='inactive_ingredients[]']").on("change",function(){var a="";$.each($(this).find(":selected"),function(b){a+=(b>0?",":"")+$(this).val()}),$("[name$='inactive_ingredients']").val(a)}),$(".claim_item").on("keyup",function(){var a="";$.each($(".claim_item"),function(){a+=(""===a?"":":")+$(this).val()}),$("#item_label_claim").val(a),$("#CLAIM").text(a)}),$.chai.markets.ini(),$.chai.trial.trial_arm_primer(),$("#add_lmic").on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$("#LMICdata").find(".dataTable"),c=[],d=$("#LMICdata tbody select").length,e='<input type="hidden" name="lmics['+d+'].id" value="0"/>';c.push(e+'<input type="text" placeholder="label claim amount" name="item.lmics['+d+'].form"/>'),c.push('<input type="checkbox" value="yes" name="lmics['+d+'].lmic_1l"/>'),c.push('<input type="checkbox" value="yes" name="lmics['+d+'].lmic_2l"/>'),c.push('<input type="checkbox" value="yes" name="lmics['+d+'].lmic_3l"/>'),c.push('<input type="checkbox" value="yes" name="lmics['+d+'].tbd"/>'),c.push('<a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'),b.dataTable().fnAddData(c),$("#LMICdata tbody .removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".dataTable").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})})}),$.chai.drug.setup_ddi_ui()},setup_ddi_ui:function(){$("#drug_interaction").on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$("#ddi").find(".dataTable"),c=[],d=$("#ddi_drug_product").length>0,e=$("#ddi tbody select").length,f="interactions["+e+"]",g="";d&&(f="interactions["+e+"]",g='<input type="hidden" name="'+f+'.id" value="0"/><select name="'+f+'.substance" id="drpr_'+e+'"><option value="">Select</option></select>',c.push(g)),g='<input type="hidden" name="'+f+'.id" value="0"/><select name="'+f+'.substance"  id="ddi_only_'+e+'"><option value="">Select</option></select>',c.push(g),g='<select name="'+f+'.yes_no"><option value="yes">Yes</option><option value="no">No</option></select>',c.push(g),g='<input type="text" name="'+f+'.dose_amount" value="" style="width:100%"/>',c.push(g),c.push('<textarea placeholder="Describe the interaction between the two drugs" name="'+f+'.descriptions"  rows="1"></textarea>'),c.push('<a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'),b.dataTable().fnAddData(c),d&&$.getJSON("/center/substances.castle?ddi_only=false&json=true&callback=?",function(a){$.each(a,function(a,b){$("#drpr_"+e).append("<option value='"+b.baseid+"' data-baseid='"+b.baseid+"' data-name='"+b.name+"' data-abbreviated='"+b.abbreviated+"'   >"+b.name+" ( "+b.abbreviated+" )</option>")})}),$.getJSON("/center/substances.castle?json=true&callback=?",function(a){$.each(a,function(a,b){$("#ddi_only_"+e).append("<option value='"+b.baseid+"' data-baseid='"+b.baseid+"' data-name='"+b.name+"' data-abbreviated='"+b.abbreviated+"'   >"+b.name+" ( "+b.abbreviated+" )</option>")})}),$("#ddi tbody .removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".dataTable").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})})})}},$.chai.substance={ini:function(){$.chai.core.util.setup_viewlog(),$.chai.form_base.ini(),$("#ddiradio").buttonset(),$("#ddiradio :radio").on("change",function(){$("#ddiradio :radio").next("label").find("i").removeClass("icon-check-empty").removeClass("icon-check"),$("#ddiradio :radio").not(":checked").next("label").find("i").addClass("icon-check-empty"),$("#ddiradio :radio:checked").next("label").find("i").addClass("icon-check")}),$("#add_substance_salt").on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$("#Saltdata.dataTable"),c=[],d=$("#Saltdata tbody select").length,e='<input type="hidden" name="salts['+d+'].id" value="0"/><select name="salts['+d+'].is_salt"><option value="Yes">Yes</option><option value="No">No</option></select>';c.push(e),c.push('<input type="text" value="" name="salts['+d+'].form"/>'),c.push('<a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'),b.dataTable().fnAddData(c),$("#Saltdata tbody .removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".dataTable").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})})}),$("#add_substance_prodrug").on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$("#Prodrugdata.dataTable"),c=[],d=$("#Prodrugdata tbody select").length,e='<input type="hidden" name="prodrugs['+d+'].id" value="0"/>';c.push(e+'<input type="text" value="" name="prodrugs['+d+'].active_moiety"/>'),c.push('<input type="text" value="" name="prodrugs['+d+'].active_metabolites"/>'),c.push('<a href="#" class="button xsmall crimson defocus removal"><i class="icon-remove" title="Remove"></i></a>'),b.dataTable().fnAddData(c),$("#Prodrugdata tbody .removal").off().on("click",function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest("tr"),c=$(this).closest(".dataTable").dataTable();b.fadeOut("75",function(){c.fnDeleteRow(c.fnGetPosition(b.get(0)))})})})}},$.chai.reference={ini:function(){$.chai.form_base.ini(),$("#load_file").on("click",function(){$(".load_file").toggleClass("active"),$(".load_file input").removeAttr("required"),$(".load_file:visible input").attr("required",!0)})}},function(a){a.chai.ready=function(b){a(document).ready(function(){var c,d;return d=window.location.pathname,c=d.substring(d.lastIndexOf("/")+1),c=c.substring(0,c.lastIndexOf(".")),"undefined"!=typeof a.chai[c]?(a.chai[c].ini(),a.chai.core.util.setup_ref_copy()):a.chai.core.util.make_dataTables(),b})},a.chai.ini()}(jQuery);